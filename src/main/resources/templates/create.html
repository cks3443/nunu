<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title></title>
    <script src="https://use.fontawesome.com/releases/v6.1.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"
          type="text/css"/>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link th:href="@{/css/styles.css}" rel="stylesheet"/>
    <link th:href="@{/css/newStyle.css}" rel="stylesheet"/>
    <link th:href="@{/css/main.css}" rel="stylesheet"/>

    <style th:replace="~{fragments/common_parts :: styleFragment}"></style>
</head>
<body id="page-top">
<div class="container-fluid" id="app">
    <div class="row">

        <div th:replace="~{fragments/common_parts :: menubar}"></div>

        <div class="col-10">
            <div class="row">
                <!-- Navigation-->

                <nav th:replace="~{fragments/common_parts :: navbar}"></nav>

                <section class="page-section">
                    <div class="container">
                        <!-- Section Form-->
                        <div class="row justify-content-center">
                            <div class="fontStyle">
                                <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                                    <button type="button" class="btn btn-outline-primary">가벼운</button>
                                    <button type="button" class="btn btn-outline-primary">산뜻한</button>
                                    <button type="button" class="btn btn-outline-primary">반듯한</button>
                                    <button type="button" class="btn btn-outline-primary">정중한</button>
                                    <button type="button" class="btn btn-outline-primary">진지한</button>
                                    <a href="block_edit.html" type="button" class="btn btn-outline-primary"
                                       style="max-width: 100px;background-color:black; color:white; opacity:unset">블록편집</a>
                                </div>
                                <hr/>
                            </div>
                            <div>
                                <div class="btn-group alignType" role="group">
                                    <button type="button" class="btn btn-outline-primary"><i
                                            class="fa-solid fa-align-left"></i></button>
                                    <button type="button" class="btn btn-outline-primary"><i
                                            class="fa-solid fa-align-center"></i></button>
                                    <button type="button" class="btn btn-outline-primary"><i
                                            class="fa-solid fa-align-right"></i></button>
                                    <button type="button" class="btn btn-outline-primary"><i
                                            class="fa-solid fa-align-justify"></i></button>
                                    <a href="mobile_view.html" style="border: 0 !important;" type="button"
                                       class="btn btn-outline-primary"><i class="fa-solid fa-mobile-screen"></i></a>
                                </div>
                            </div>
                            <div class="col-lg-8 col-xl-7">
                                <form v-if="post">
                                    <!-- Memo input-->
                                    <div
                                            style="padding: 0px;margin: 0px;"
                                    >

                                        <div class="form-floating mb-3" style="margin-bottom: unset !important;">
                                            <input style="border: unset; font-size: 1.5rem; width: 100%; text-align: center;"
                                                   class="form-control"
                                                   type="text"
                                                   placeholder="Enter your title..."
                                                   v-model="post.title"
                                            />
                                            <label>Title</label>
                                        </div>

                                        <!-- SubHeading1 input-->
                                        <div id="repeatDiv" class="repeatDiv">
                                            <div v-for="(sub, index) in post.subs">
                                                <span style="float: right; color:#ced4da; font-size: 25px;">...</span>
                                                <div class="form-floating mb-3  input-group forminput">
                                                    <input
                                                            class="form-control subHead"
                                                            type="text"
                                                            placeholder="Your SubHeading1"
                                                            style="padding: 10px;"
                                                    />
                                                    <label>{{'SubHeading' + (index + 1)}}</label>
                                                </div>
                                                <div
                                                        class="form-floating mb-3  input-group forminput repeatKeyword"

                                                        v-for="(keyword, k) in sub.keywords"
                                                >
                                                    <input
                                                            class="form-control addstyle"
                                                            type="text"
                                                            placeholder="Keyword"
                                                            style="padding: 10px;"

                                                            v-model="post.subs[index].keywords[k]"
                                                    />
                                                    <label>Keyword</label>
                                                    <button
                                                            class="btn btn-outline-secondary"
                                                            type="button"
                                                            v-on:click="setShowControlPanelValue(index)"
                                                    >
                                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                                    </button>
                                                </div>

                                                <div
                                                        class="btn-group "
                                                        role="group"
                                                        aria-label="Basic checkbox toggle button group"

                                                        v-if="sub.showControlPanel"
                                                >
                                                    <button
                                                            type="button"
                                                            class="btn btn-outline-primary"
                                                            style="background-color: #FDFAF5; color: #CACACA;"

                                                            v-on:click="addSub(index)"
                                                    >
                                                        <i class="fa-solid fa-equals"></i>
                                                    </button>

                                                    <button
                                                            type="button"
                                                            class="btn btn-outline-primary"
                                                            style="background-color: #FDFAF5; color: #CACACA;"

                                                            v-on:click="addKeyword(index)"
                                                    >
                                                        <i class="fa fa-minus"></i>
                                                    </button>

                                                    <button
                                                            type="button"
                                                            class="btn btn-outline-primary"
                                                            style="background-color: #FDFAF5; color: #CACACA;"

                                                            v-on:click="addImage(index)"
                                                    >
                                                        <i class="fa-regular fa-images"></i>
                                                    </button>

                                                    <button
                                                            type="button"
                                                            class="btn btn-outline-primary"
                                                            style="background-color: #FDFAF5; color: #CACACA;"

                                                            v-on:click="clickImgBtnHandler(index)"
                                                    >
                                                        <i class="fa-regular fa-image"></i>
                                                    </button>

                                                </div>


                                                <div
                                                        v-if="sub.images.length != 0"
                                                >
                                                    <div class="row" style="padding: 0 30px;">
                                                        <div
                                                                class="column"

                                                                v-for="(img_id, img_index) in post.subs[index].images"
                                                        >
                                                            <div class="form-input">
                                                                <div class="preview"></div>
                                                                <label
                                                                        v-bind:for="'id_' + index + '_' + img_index"
                                                                >
                                                                    <img
                                                                            v-if="post.subs[index].images[img_index] == ''"
                                                                            src="/assets/img/image_frame.svg"
                                                                    />
                                                                    <img
                                                                            v-if="post.subs[index].images[img_index] != ''"
                                                                            v-bind:src="'/files/' + img_id"
                                                                    />
                                                                </label>
                                                                <input
                                                                        @change="uploadImageEventHandler(index, img_index, $event)"
                                                                        v-bind:id="'id_' + index + '_' + img_index"
                                                                        type="file"
                                                                        accept="image/*"
                                                                />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                                <div
                                                        style="margin: 0px;padding: 0px;"

                                                        v-if="post.subs[index].showFileUploadPan"
                                                >
                                                    <div class="upload__img-wrap"></div>
                                                    <!-- MULTIPLE IMAGE UPLOAD-->
                                                    <input
                                                            type="file"
                                                            class="imageForm"
                                                            v-bind:id="'my-form-' + index"
                                                            multiple
                                                            style="display: none;"

                                                            accept="image/*, .pdf, .psd"

                                                            @change="changeFileUploadHandler($event, index)"
                                                    />
                                                    <label
                                                            v-bind:for="'my-form-' + index"
                                                            style="display: flex;"
                                                            class="multiple-uploader"
                                                            id="multiple-uploader"
                                                    >
                                                        <div class="mup-msg">
                                                            <span class="mup-main-msg">+ Files</span>
                                                            <span class="mup-msg" id="max-upload-number"></span>
                                                            <span class="mup-msg">(image, pdf, psd)</span>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>


                                            <div class="row image3">
                                                <div class="column">
                                                    <div class="form-input">
                                                        <div class="preview"></div>
                                                        <label>
                                                            <img th:src="@{/assets/img/Image_frame_pc.svg}"
                                                                 alt="..."/>
                                                        </label>
                                                        <input type="file" accept="image/*"
                                                               onchange="showPreview(event);">
                                                    </div>
                                                </div>
                                                <div class="column">
                                                    <div class="form-input">
                                                        <div class="preview"></div>
                                                        <label>
                                                            <img th:src="@{/assets/img/Image_frame_pc.svg}"
                                                                 alt="..."/>
                                                        </label>
                                                        <input type="file" accept="image/*"
                                                               onchange="showPreview(event);">
                                                    </div>
                                                </div>
                                                <div class="column">
                                                    <div class="form-input">
                                                        <div class="preview"></div>
                                                        <label>
                                                            <img th:src="@{/assets/img/Image_frame_pc.svg}"
                                                                 alt="..."/>
                                                        </label>
                                                        <input type="file" accept="image/*"/>
                                                    </div>
                                                </div>
                                                <div class="col-1">
                                                    <i style="margin-top:1rem;"
                                                       class="fa-solid fa-ellipsis-vertical"></i>
                                                </div>
                                            </div>
                                            <div>
                                                <textarea style="width: 100%;" class="form-control textArea" type="text"
                                                          placeholder=""></textarea>
                                            </div>
                                        </div>

                                    </div>


                                    <div class="row btnGroup">
                                        <div class="column colDiv"><a href="#" class="btn btn-primary btn-xl hideBtn"
                                                                      type="submit">
                                            <img th:src="@{/assets/img/hide.svg}"
                                                 alt="..."/> &nbsp; Sketch All
                                        </a></div>
                                        <div class="column colDiv"><a href="#" class="btn btn-primary btn-xl hideBtn"
                                                                      type="submit">
                                            <img th:src="@{/assets/img/hide.svg}"
                                                 alt="..."/>&nbsp; Keyword</a>
                                        </div>
                                    </div>
                                    <div class="saveBtn"><a href="main.html" style=" width: 100%; margin-top: 20px;"
                                                            class="btn btn-primary btn-xl" type="submit">save</a></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue@2.7.13/dist/vue.js"></script>

<script>

    new Vue({
        el: "#app",
        data: {
            id: [[${id}]],
            post: null,
        },
        beforeMount: function () {
            let urlroot = '/api/v1/posts'

            if (this.id != -1) {
                urlroot += `/${this.id}`
            }

            fetch(urlroot, {method: 'POST'})
                .then((r) => {
                    if (r.ok) return r.json()
                })
                .then((post) => {
                    this.post = post
                })
        },
        methods: {
            setShowControlPanelValue: function (index) {

                this.post.subs[index].showControlPanel =
                    !(this.post.subs[index].showControlPanel)
            },
            addSub: function (index) {

                let urlroot = '/api/v1/subs'

                fetch(urlroot, {method: 'POST'})
                    .then((r) => {
                        if (r.ok) return r.json()
                    })
                    .then((sub) => {

                        this.post.subs.splice(index + 1, 0, sub)
                    })

            },

            addKeyword: function (pindex) {
                this.post.subs[pindex].keywords.push("")
            },

            addImage: function (index) {
                if (this.post.subs[index].images.length < 3) {

                    this.post.subs[index].images.push("")
                }
            },
            uploadImageEventHandler: function (index, img_index, event) {
                let data = new FormData()

                data.append('file', event.target.files[0])

                fetch('/upload', {method: 'POST', body: data})
                    .then((r) => {
                        if (r.ok) return r.text()
                    })
                    .then((url) => {
                        this.post.subs[index].images[img_index] = url

                        this.$forceUpdate()
                    })
            },

            clickImgBtnHandler: function (index) {
                this.post.subs[index].showFileUploadPan = !(this.post.subs[index].showFileUploadPan)

                this.$forceUpdate()
            },

            changeFileUploadHandler: function (event, index) {

                let data = new FormData()

                if (event.target.files.length == 0) return

                [0, 1, 2, 3, 4].forEach((v) => {

                    if (v <= event.target.files.length - 1) {

                        data.append('files', event.target.files[v])
                    }
                })


                fetch('/muploads', {method: 'POST', body: data})
                    .then(r => {
                        if (r.ok) return r.json()
                    })
                    .then((d) => {

                        this.post.subs[index].files = d
                    })

            },
        }
    })

</script>
</body>
</html>
